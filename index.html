<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">
<title>Time Blob</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
</head>
<body>
<div class="wrapper">

<div class="timer-area">
<div id="stopwatch">
    <h1 id="stopwatch-time"></h1>
    <img id="clock-hand" src="img/clock-hand-active.svg">
    <p id="stopwatch-message">tap to start</p>
</div>
</div>

<div id="current-form-area">
<form id="current-entry-form">
    <label for="input-activity">Activity</label>
    <input size="" title="" type="text" name="activity" value="" placeholder="" id="input-activity">

    <label for="input-project">Project</label>
    <input size="" title="" type="text" name="project" value="" placeholder="" id="input-project">

    <label for="input-client">Client</label>
    <input size="" title="" type="text" name="client" value="" placeholder="" id="input-client">

    <label for="input-activity">Org.</label>
    <input size="" title="" type="text" name="organization" value="" placeholder="" id="input-organization">

    <label for="input-total-time">Time</label>
    <input size="" title="" type="text" name="total-time" value="" placeholder="" id="input-total-time">

    <label for="input-start-time">Start</label>
    <input size="" title="" type="text" name="start-time" value="" placeholder="" id="input-start-time">
    <input size="" title="" type="text" name="start-date" value="" placeholder="" id="input-start-date">

    <label for="input-end-time">End</label>
    <input size="" title="" type="text" name="end-time" value="" placeholder="" id="input-end-time">
    <input size="" title="" type="text" name="end-date" value="" placeholder="" id="input-end-date">

    <button type="submit" value="Send" id="entry-form-submit-button">Submit</button>
</form>
</div>
</div>

<div class="table-wrapper">
<table id="sessions-table">
    <tr>
        <td colspan="2" class="date-line"><span></span>6/23<span></span></td>
    </td>
    <tr class="list-entry-row">
        <td><span>Head Meta Tag Updates</span></td>
        <td>1h 43m</td>
    </tr>
    <tr class="list-entry-row">
        <td><span>Minor Style Sheet Adjustments</span></td>
        <td>39m</td>
    </tr>
    <tr class="list-entry-row">
        <td><span>Git Cleanup</span></td>
        <td>3h 2m</td>
    </tr>
    <tr>
        <td colspan="2" class="date-line"><span></span>6/22<span></span></td>
    </tr>    
    <tr class="list-entry-row">
        <td><span>Creating Identity Concepts</span></td>
        <td>4h 11m</td>
    </tr>
    <tr>
        <td colspan="2" class="date-line"><span></span>6/21<span></span></td>
    </tr>  
    <tr class="list-entry-row">
        <td><span>Identity Discovery</span></td>
        <td>1h 31m</td>
    </tr>
    <tr class="list-entry-row">
        <td><span>Identity Discovery</span></td>
        <td>2h 14m</td>
    </tr>
    <tr class="list-entry-row">
        <td><span>Client Consultation</span></td>
        <td>1h</td>
    </tr>
    <tr class="list-entry-row">
        <td><span>UX Design</span></td>
        <td>2h 34m</td>
    </tr>
    <tr>
        <td colspan="2" class="date-line"><span></span>6/18<span></span></td>
    </tr>
    <tr class="list-entry-row">
        <td><span>Client Call</span></td>
        <td>15m</td>
    </tr>
    <tr class="list-entry-row">
        <td><span>Design Comittee Presentation</span></td>
        <td>1h 17m</td>
    </tr> 
    <tr class="list-entry-row">
        <td><span>Presentation Prep</span></td>
        <td>4h 7m</td>
    </tr>
    <tr class="list-entry-row">
        <td><span>Concept Prep</span></td>
        <td>24m</td>
    </tr>
    <tr class="list-entry-row">
        <td><span>Identity Concept Design</span></td>
        <td>3h 23m</td>
    </tr>
    <tr>
        <td colspan="2" class="date-line"><span></span>6/17<span></span></td>
    </tr>
    <tr class="list-entry-row">
        <td><span>Identity Concept Design</span></td>
        <td>3h 23m</td>
    </tr>
    <tr class="list-entry-row">
        <td><span>Identity Concept Design</span></td>
        <td>1h 47m</td>
    </tr>
    <tr class="list-entry-row">
        <td><span>Client Phone Call</span></td>
        <td>1h 3m</td>
    </tr>
    <tr class="list-entry-row">
        <td><span>Identity Concept Design</span></td>
        <td>2h 23m</td>
    </tr>
    <tr class="list-entry-row">
        <td><span>Rework of Form Front End</span></td>
        <td>1h 14m</td>
    </tr>
    <tr>
        <td colspan="2" class="date-line"><span></span>6/16<span></span></td>
    </tr>
    <tr class="list-entry-row">
        <td><span>UX Consultation</span></td>
        <td>2h 10m</td>
    </tr>
    <tr class="list-entry-row">
        <td><span>Identity Concept Design</span></td>
        <td>1h 19m</td>
    </tr>
    <tr>
        <td colspan="2" class="date-line">Scroll to load 20 more</td>
    </tr>
</table>

</div>

<script>
//sizing the stopwatch
resizeStopwatch ();
function resizeStopwatch () {
    var stopwatchWidth = $('#stopwatch').width();
    var stopwatchHeight = $('#stopwatch').height();
    $('#stopwatch-time').css('width', stopwatchWidth + 'px');
    $('#stopwatch-time').css('font-size', stopwatchHeight / 128 + 'em');
    var stopwatchTimeSize = $('#stopwatch-time').css('font-size').replace(/[^-\d.]/g, '');
    $('#stopwatch-time').css('top', stopwatchWidth / 2 - stopwatchTimeSize / 2 + 'px');
}
$(window).resize(resizeStopwatch);

//click to start and stop the clock
var degree = 0, timer, isRunning = false;
$('#clock-hand').click(function() {
    if (!isRunning) {
        rotate();
        stopwatchRun();
        isRunning = true;
        $('#stopwatch-message').text('tap to pause');
    } else if (isRunning && totalSessionTime != 0) {
        isRunning = false;
        $('#stopwatch-message').text('tap to resume');        
    } else {
        isRunning = false;
        $('#stopwatch-message').text('tap to start');
    }
});

//the stopwatch time tracker starts at zero and adds a seconds every 1000 milliseconds
var totalSessionTime = 0, stopwatch, totalSessionTimeFormated;
function stopwatchRun () {
    stopwatch = setTimeout(function() {
        if (!isRunning) {
            return;
        } else {
            totalSessionTime = ++totalSessionTime;
            stopwatchRun();
        }
    },1000);
    //format total session time for stopwatch face
    if (totalSessionTime < 60) {
        totalSessionTimeFormatted =  totalSessionTime +'s';
    } else if (totalSessionTime < 3600) {
        totalSessionTimeFormatted = Math.floor(totalSessionTime / 60) + 'm ' + totalSessionTime % 60 + 's';
    } else if (totalSessionTime < 3660) {
        totalSessionTimeFormatted = Math.floor(totalSessionTime / 3600) + 'h ' + Math.floor(totalSessionTime % 3600) + 's';
    } else if (totalSessionTime >=3660) {
        totalSessionTimeFormatted = Math.floor(totalSessionTime / 3600) + 'h ' + Math.floor((totalSessionTime % 3600) / 60) + 'm';
    }
    //output total time on stopwatch face, and form field
    $('#stopwatch-time').text(totalSessionTimeFormatted);
    $('input#input-total-time').val(totalSessionTimeFormatted);
}

//rotate the clock hand 0.24 degrees every 40 milliseconds (25fps)
function rotate() {
    $('#clock-hand').css({ 'transform': 'rotate(' + degree + 'deg)'});                      
    timer = setTimeout(function() {
        degree = degree + 0.24;
        if (!isRunning) {
            return;
        } else {
            rotate();
        }
    },40);
}

//Edit Mode for List Entries
var isInEditMode = false;
var selectedColumnActivity;
var selectedColumnTime;
$('tr.list-entry-row').click(function() {
    if (!isInEditMode) {
        // Enter edit mode
        isInEditMode = true;
        $(this).addClass('selected-entry');
        $(this).after('<tr class="edit"><td colspan="2"></td></tr>');
        // Load in the edit form
        $('tr.edit td').load('edit-form.html', function () {
            $('#edit-entry-form').animate({'max-height': '1000px'}, 200, "linear");
            //$('#edit-entry-form').css('transition', 'max-height 1s');
            //$('#edit-entry-form').css('max-height', '1000px');
            //$('tr.edit td').css('height', '170px');
        });
        
        // Remember the entry's data
        selectedColumnActivity = $('tr.selected-entry td:first-child').html();
        selectedColumnTime = $('tr.selected-entry td:last-child').html();
        $('tr.selected-entry').empty();
        $(this).removeClass('list-entry-row');
        $('tr.selected-entry').html('<td colspan="2" class="open-entry"><img src="img/white-menu-triangle.svg"></td>');
    } else {
        // Exit edit mode
        
        //$('#edit-entry-form').css('max-height', '0px');
        $('#edit-entry-form').animate({'max-height': '0px'}, 200, "linear", function(){
            $('tr.edit').remove().empty();
            $('tr.selected-entry').addClass('list-entry-row');
            $('tr.selected-entry').html('<td>' + selectedColumnActivity + '</td><td>' + selectedColumnTime + '</td>');
            $('tr.selected-entry').removeClass('selected-entry');
        });
        isInEditMode = false;
    }
});
</script>

</body>
</html>